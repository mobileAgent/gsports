.RegContent
  .SideBar
    %h1
      Registration
    %p
      This is the last step of the registration process.
      Enter the name and address here as it shows on your
      credit card.

  .RegistrationContent
    .RegistrationTrail
      PART 1: ACCOUNT TYPE &raquo; PART 2: USER INFORMATION &raquo; 
      %span.RegistrationComplete
        PART 3: BILLING INFORMATION
      
    .AccountType
      %br/
      %h2= "The cost for this membership is #{number_to_currency(@user.role.plan.cost)} per month"
      %br/
      
      %form{:action=>'/users/submit_billing',:class => 'MainForm',:method => :post}
  
        = error_messages_for :credit_card, :user, :billing_address, :object_name => 'Billing Information'
        - if @billing_gateway_error
          .warning
            = @billing_gateway_error
        
        %label{"for"=>"firstname"}
        First Name
        %em (Required: )
        %br
        = text_field :credit_card, :first_name
  
  
        %label{"for"=>"lastname"}
        Last Name
        %em (Required: )
        %br
        = text_field :credit_card,:last_name,  :size => 10

        %fieldset.inline
          %label{"for"=>"expiration_date"}
          Expiration Date:
          %em (Required: )
          %br/
          =collection_select(:credit_card, :year, cc_years,"number","name",{:prompt => '-Year-', :selected => @credit_card.year })
          =collection_select(:credit_card, :month, cc_months,"number","name",{:prompt => '-Month-', :selected => @credit_card.month })
  
        %label{"for"=>"number"}
        Card Number
        %em (Required: )
        %br
        = text_field :credit_card, :number, :size => 16, :maxlength => 16
  
        %label{"for"=>"verification_value"}
        Verification number
        %em (Required: )
        %br
        = text_field :credit_card, :verification_value, {:size => 4, :maxlength => 4}
  
        - skip_billing = (@billing_address.nil? || @billing_address.address1.blank?)
        - if skip_billing
          %fieldset.inline
            %input{:type => 'checkbox', :checked => (skip_billing ? 'checked' : ''), :name => 'skip_billing_address', :id => 'skip_billing_address', :onclick => "this.checked ? $$('#billingAddress')[0].hide() : $$('#billingAddress')[0].show()"}
            %label{:for => 'skip_billing_address'}
              Use primary account address as billing address
        - elsif @billing_address
          = hidden_field_tag 'billing_address[id]', @billing_address.id
      
        %div{:id => 'billingAddress', :style => (skip_billing ? "display:none" : "display:block")}
      
          %label{:for=>'address1'}
          Address Line 1
          %br/
          = text_field :billing_address, :address1
      
          %label{:for=>'address2'}
          Address Line 2
          %br/
          = text_field :billing_address, :address2
      
          %label{:for=>'city'}
          City
          %br/
          = text_field :billing_address, :city
      
          %label{:for => 'state'}
          State
          %br/
          =collection_select(:billing_address ,:state , State.all,"name","name", { :prompt => 'Choose State', :selected => (@billing_address.state? ? @billing_address.state : '') })
          
          
          %label{:for=>'zip'}
          Zip/Postal Code
          %br/
          = text_field :billing_address, :zip
          / end of billing address 

        %fieldset.inline
          %input#tos{:name=>"tos", :type=>"checkbox", :value=>"tos", :checked=>params[:tos]}
          %label{:for => "tos"}
            I have read and agree to the
            =link_to("#{AppConfig.community_name} Terms of Service", '/info/terms', {:target => "_blank"})

        %fieldset.inline
          %input#suba{ :name=>'suba', :type=>'checkbox', :value=>'suba', :checked=>params[:suba]}
          %label{:for => "suba"}
            I have read and agree to the
            =link_to("#{AppConfig.community_name} Subscriber Agreement", "/info/subscriber_#{@user.role.name}", {:target => "_blank"})
          
        = hidden_field_tag :inviter_id, params[:inviter_id]
        = hidden_field_tag :inviter_code, params[:inviter_code]
        = hidden_field_tag :role, @requested_role
        = hidden_field_tag :userid, @user.id
        %p= submit_tag('Submit', :onclick => "if ($$('#tos')[0].checked && $$('#suba')[0].checked) { return true; } else { alert('You must agree to the Terms of Service and the Subscriber Agreement'); return false; }")
  
  
  
  
  
