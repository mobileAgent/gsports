= javascript_include_tag 'video_assets'
-# allowed = current_user && current_user.enabled? && current_user.has_access?(@video_asset)
-# allowed = current_user && ((current_user.enabled? && current_user.has_access?(@video_asset)) || (current_user.can_ppv?) )
- allowed = current_user && current_user.has_access?(@video_asset)
.profileContentArea.listingPage
  .profilePageHeader
    -if @render_gamex_menu
      %h2.columnDescriptor
      %div{ :style=>'float: right;' }
        .gamexButton
          =link_to 'Download', "/video_assets/download/#{@video_asset.id}"  #@video_asset.download_url()
      %span
        GameXchange
      &gt; Watch Video
    -else
      - if (!allowed && !@video_asset.is_restricted?)
        You are watching a short preview of this video. For full access options, click "Purchase Video" below".
      -else
        %h2.columnDescriptor
        %span
          = link_to _('MY VIDEOS'), url_for({:controller => 'search', :action => 'my_videos', :user_id => (@user ? @user.id : nil)})
        Player
  .playerContentArea
    .leftNavColPlayer
      .leftNavPlayer{ :style=>'width:490px;' }
        - if (allowed || !@video_asset.is_restricted?)
          = render :partial => 'ratings/stars', :locals => { :item => @video_asset }
          %a{ :href=>"http://www.facebook.com/sharer.php?u=#{APP_URL}/video_assets/#{@video_asset.id}", :style=>'float:right;' }
            %img{ :src=>'/images/fb_share.jpg' }
          - if allowed
            = render :partial => 'shared/video_actions', :locals => { :video_listing => @video_asset, :ppv => @ppv }
          -else
            %a{ :href=>"javascript:gs.video_assets.buy_video(#{@video_asset.id})", :style=>'float:right;' }
              %img{ :src=>'/images/purchase.jpg' }
            -#.ppv-action-purchase-video
              %a{ :href=>"javascript:gs.video_assets.buy_video(#{@video_asset.id})" }= 'Purchase Video'
            -#= link_to image_tag('/images/purchase_video.png', :border=>0, :alt => 'Purchase Video', :title => 'Purchase Video'), "javascript:gs.video_assets.buy_video(#{@video_asset.id})"
    .flashArea#flashArea
    - if @vidavee && session[:vidavee] && @video_asset.dockey && (allowed || !@video_asset.is_restricted?)
      - params = {:allowFullScreen=>"true"}
      - fvars = {:dockey => @video_asset.dockey, :allowFS => "true"}
      - player_name = '/players/clipmaker.swf'
      - if !allowed
        - fvars[:previewTime] = 60
        - player_name = '/players/clipmaker-ppv.swf'
      = render(:partial => 'shared/video_player', :locals => { :player_name => player_name, :fvars => fvars, :params => params, :target => 'flashArea', :height => 685, :width => 800 })
      
    .clearDiv
  
    .commentContainer
      %br
      .commentArea
        .forumContentBox
          -if allowed
            .commentForm
              =render :partial => 'comments/comment_form', :locals => { :commentable => @video_asset }
            .comments#comments
              #newest_comment
              =render :partial => 'comments/comment', :collection => @video_asset.comments
            %span#more_comments_links= more_comments_links(@video_asset)
          -elsif @video_asset.is_restricted?
            Weâ€™re sorry, but this video is currently restricted. Please contact your coach at 
            - team_name = (@video_asset.team ? @video_asset.team.name : '   ' )
            = link_to team_name, team_path(@video_asset.team) 
            to inquire about gaining in-season access to this video.
    
